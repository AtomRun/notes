# 延迟支付

即，下单之后不付款，会进入付款倒计时的状态，在倒计时时间段内可以随时付款

但是当用户时间到头之后，需要触发订单取消的机制，就像优惠券到期之后触发的机制，我们没有主动触发的机制，只能使用被动的方式，我们之前谈到的两种方式，之前判断优惠券的方式是，每次查询判断优惠券的时间区间的方式解决的问题，订单支付时间过期的方式如下

1. 主动轮询
2. 延迟消息队列，推送一条消息，触发优惠券/订单状态的改变
   1. 如果消息没有成功发送，那么时间到了之后订单也会使UNpaid状态

createTime 订单创建时间

pay-Time-Limit 设置的订单延迟支付的时间

## 两种方式

1. 订单一旦生成，就将endTime写入到数据库中
   1. 如果当前时间小于等于endTime，说明当前还是UNPAID状态
   2. now>endTime已取消状态
2. 不写入endTime，而是实时去计算，每次查询判断endTime时间

## 订单的创建时间是什么？

订单的创建时间是mysql数据库自动触发生成数据的时间戳，还是java中自己计算的now，我们必须要统一这两个时间

因为假设数据库的创建时间是自己生成的,而过期时间是java取到的now来决定的,这样过期时间就不会很准确,所以我们这里决定将订单的创建时间设置为java中获取的now,而不是数据库自动生成createTime

## expiredTime的意义

如果订单过期时间不需要改变,那么就不需要,但是如果以后有变动,就需要动态设置过期时间,来